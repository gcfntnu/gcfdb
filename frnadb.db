#-*- mode:snakemake -*-
"""
Mituyama T, Yamada K, Hattori E, Okida H, Ono Y, Terai G, Yoshizawa A, Komori T, Asai K.
The Functional RNA Database 3.0: databases to support mining and annotation of functional RNAs.
Nucleic Acids Research/2009/D89-92
"""

FRNADB_VERSION = config['db'].get('frnadb_version', '20160329')

FRNADB_ORG = {'homo_sapiens': 'Homo_sapiens',
      	      'human': 'Homo_sapiens',			
              'mus_musculus': 'Mus_musculus',	
              'mouse': 'Mus_musculus',
              'rattus_norvegicus': 'Rattus_norvegicus',
              'rat': 'Rattus_norvegicus',
              'rno': 'Rattus_norvegicus'}

rule frnadb_fasta:
    params:
        url = 'ftp://ftp.biosciencedbc.jp/archive/frnadb/{}/Sequence_Data'.format(FRNADB_VERSION),
        frnadb_org = lambda wildcards: FRNADB_ORG[wildcards.org]
    output:
        join(EXT_DIR, 'frnadb', '{org}', 'fasta', 'frna.fa')
    log:
        join(EXT_DIR, 'frnadb', '{org}', 'logs', 'frna.log')
    run:
        shell('wget -O- {params.url}/{params.frnadb_org}.zip | unzip -c > {output}')
        date = datetime.now().strftime("%d-%m-%Y")
        with open(log[0], 'w') as fh:
            fh.write('Functional RNA Database,{},{},{}'.format(FRNADB_VERSION, params.url, date))
