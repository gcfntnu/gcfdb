#-*- mode:snakemake -*-
include:
  'ercc.db'
include:
  'smallrna_calibrators.db'
include:
    'indexes.rules'

SPIKE_DIR = join(EXT_DIR, 'spikein')
FILTER_CONF = config.get('filter')
if FILTER_CONF is None:
   config['filter'] = FILTER_CONF = {}
SPIKE_CONF = FILTER_CONF.get('spikein')
if SPIKE_CONF is None:
   config['filter']['spikein'] = SPIKE_CONF = {}
REF = config['filter']['spikein'].get('ref', '').split(',')
   
def spikein_get_fasta(REF):
    out = []
    for r in REF:
        if r.lower() == 'ercc':
            out.append(join(EXT_DIR, 'ERCC', 'fasta', 'ERCC92.fa'))
        if r.lower() == 'smallrna_calibrators':
            out.append(join(EXT_DIR, 'smallrna_calibrators', 'fasta', 'calibrators.dna.fa'))
    return out

rule spikein_fasta:
    input:
        spikein_get_fasta(REF)
    output:
        join(SPIKE_DIR, 'fasta', 'spikein.fa')
    shell:
        'cat {input} > {output}'
        

rule spikein_indexes:
    input:
        join(EXT_DIR, 'ERCC', 'index', 'ERCC92', 'bowtie', 'ERCC92.1.ebwt')
