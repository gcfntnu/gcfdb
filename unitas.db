#-*- mode:snakemake -*-
"""Extra reference sequences for unitas.

Additional files that contain reference sequeces in FASTA format. FASTA headers should have the following format: >ncRNA_type|ncRNA_name 

This will be added to ncRNA.fas
"""
include:
    'contaminants.db'

CALIBRATORS_EXTEND = config['filter'].get('calibrators_extend', False)
UNITAS_REFSEQ = []
_unitas_map = {'homo_sapiens': 'Human',
              'human': 'Human',
               'hsa': 'Human',
               'mus_musculus': 'Mouse',
               'mouse': 'Mouse',
               'mmu': 'Mouse'}
UNITAS_ORG = _unitas_map[config.get('organism')]

rule contaminants_unitas:
    input:
        join(EXT_DIR, 'univec_core', 'fasta', 'univec_core.fa')
    params:
        script = srcdir('scripts/contaminants_unitas.py')
    output:
        temp(join(INTERIM_DIR, '_contaminants_unitas_formatted.fa'))
    shell:
        'python {params.script} {input} > {output}'

rule unitas_db:   
    output:
        directory(join(EXT_DIR, 'unitas', 'UNITAS_refdump_{}'.format(ORG)))
    singularity:
        'docker://' + config['docker']['unitas']     
    shell:
        """
        unitas.pl -latest_ref -species {ORG} -input haha.txt
        mv UNITAS_refdump_* {EXT_DIR}/unitas/
        """
